# ============================================
# üóÉÔ∏è LIQUIBASE CHANGESET: CUSTOMER TABLE CREATION
# ============================================
# Purpose: Create the foundational CUSTOMER table
# Location: src/main/resources/db/changelog/changes/v1.0/
# Included in: changelog-master.yaml
# ============================================

databaseChangeLog:
  - changeSet:
      # üÜî UNIQUE IDENTIFIER (CRITICAL)
      # Format: [description]-[type]-[sequential]
      # Best Practice: Use descriptive, sequential IDs
      # ‚ùó Must be unique across entire changelog history
      # ‚ùó Never change after deployment
      id: create-customer-table-sql
      
      # üë§ AUTHOR TRACKING
      # Purpose: Track who created the migration
      # Format: team-name or individual username
      # Example: backend-team, dba-team, atquil
      author: atquil
      
      # üìù CHANGE DESCRIPTION
      # Purpose: Human-readable description for documentation
      # Displayed in: Liquibase logs, reports, audits
      # Tip: Be specific about what the change does
      comment: "Creating Customer Table - Foundation table for user management"
      
      # üóÑÔ∏è DATABASE MANAGEMENT SYSTEM
      # Purpose: Restrict migration to specific DBMS
      # Example: postgresql, mysql, oracle, h2
      # ‚ùó Prevents accidental execution on wrong database
      dbms: postgresql
      
      # ============================================
      # üîß CHANGES TO APPLY
      # ============================================
      changes:
        # üìã SQL EXECUTION BLOCK
        # Format 1: Raw SQL with pipe (|) for multi-line
        # Best for: Complex DDL, vendor-specific features
        # Alternative: Use createTable YAML for simple tables
        - sql:
            sql: |
              -- üèóÔ∏è TABLE CREATION WITH IDENTITY COLUMN
              -- GENERATED ALWAYS AS IDENTITY: PostgreSQL 10+ auto-increment
              -- PRIMARY KEY: Enforces uniqueness and creates index
              -- NOT NULL: Enforces data integrity
              -- Query
              CREATE TABLE CUSTOMER (
                id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
                username VARCHAR(50) NOT NULL,
                email VARCHAR(100) NOT NULL
              );
              
              -- üè∑Ô∏è OPTIONAL: Add table comment for documentation
              COMMENT ON TABLE CUSTOMER IS 'Stores customer information for the application';
              
              -- üîç OPTIONAL: Add column comments
              COMMENT ON COLUMN CUSTOMER.username IS 'Unique username for login';
              COMMENT ON COLUMN CUSTOMER.email IS 'Customer email address for communication';
        
        # ============================================
        # ‚Ü©Ô∏è ROLLBACK DEFINITION (CRITICAL)
        # ============================================
        # Purpose: Defines how to undo this change
        # Required for: Safe deployments, rollback plans
        # Best Practice: Always define explicit rollback
        - rollback:
            # üóëÔ∏è ROLLBACK SQL
            # CASCADE: Automatically drops dependent objects (foreign keys, etc.)
            # ‚ùó Use CASCADE carefully in production
            # Alternative: Use IF EXISTS to prevent errors
            sql: DROP TABLE IF EXISTS CUSTOMER CASCADE;
            
            # üìù ROLLBACK COMMENT (Optional but recommended)
            comment: "Rollback: Remove CUSTOMER table and all dependencies"